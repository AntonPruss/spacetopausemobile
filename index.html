<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pixelated Pattern Generator (Fixed Cell Count)</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #000;
    }
    canvas {
      display: block;
    }
    #colorControls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 9999;
      background: rgba(255,255,255,0.2);
      padding: 8px;
      border-radius: 4px;
    }
    #colorControls label {
      margin-right: 8px;
      color: #fff;
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <canvas id="pixelCanvas"></canvas>

  <!-- Color pickers for choosing custom colors -->
  <div id="colorControls">
    <label>
      Color 1:
      <input type="color" id="color1" value="#eeeeee" />
    </label>
    <label>
      Color 2:
      <input type="color" id="color2" value="#979797" />
    </label>
    <label>
      Color 3:
      <input type="color" id="color3" value="#666666" />
    </label>
    <label>
      Color 4:
      <input type="color" id="color4" value="#000000" />
    </label>
  </div>

  <script>
    const canvas = document.getElementById('pixelCanvas');
    const ctx = canvas.getContext('2d');

    // ----------------------------------------------------------------
    // 1) Fixed number of columns (width) and rows (height)
    // ----------------------------------------------------------------
    const patternCols = 500;
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    // On mobile devices, double the vertical resolution by doubling the row count
    const patternRows = isMobile ? 400 : 200;

    let cellWidth, cellHeight;
   

    // ----------------------------------------------------------------
    // 2) Retro color array -- updated from color pickers
    // ----------------------------------------------------------------
    let retroColors = ['#eeeeee', '#979797', '#666666', '#000000'];

    // Setup color picker inputs
    const colorInputs = [
      document.getElementById('color1'),
      document.getElementById('color2'),
      document.getElementById('color3'),
      document.getElementById('color4')
    ];

    // Update pattern(s) when a color changes
    colorInputs.forEach((input, index) => {
      input.addEventListener('input', () => {
        retroColors[index] = input.value;
        // Regenerate both background & pause patterns
        currentPattern = generatePattern(patternCols, patternRows);
        pauseTextPattern = generatePattern(100, 35);
      });
    });

    // ----------------------------------------------------------------
    // 3) Generate patterns
    // ----------------------------------------------------------------
    function getRandomColor() {
      return retroColors[Math.floor(Math.random() * retroColors.length)];
    }

    function generatePattern(cols, rows) {
      const pattern = [];
      for (let y = 0; y < rows; y++) {
        const row = [];
        for (let x = 0; x < cols; x++) {
          row.push(getRandomColor());
        }
        pattern.push(row);
      }
      return pattern;
    }

    // Main background & "PAUSE" text patterns
    let currentPattern = generatePattern(patternCols, patternRows);
    let pauseTextPattern = generatePattern(100, 35);

    // ----------------------------------------------------------------
    // 4) Helper functions to adjust color saturation based on vertical position
    // ----------------------------------------------------------------
    function hexToRgb(hex) {
      hex = hex.replace(/^#/, '');
      if (hex.length === 3) {
        hex = hex.split('').map(ch => ch + ch).join('');
      }
      const intVal = parseInt(hex, 16);
      return {
        r: (intVal >> 16) & 255,
        g: (intVal >> 8) & 255,
        b: intVal & 255
      };
    }

    function rgbToHex(r, g, b) {
      return "#" + [r, g, b].map(x => {
        const hex = x.toString(16);
        return hex.length === 1 ? "0" + hex : hex;
      }).join('');
    }

    function rgbToHsl(r, g, b) {
      r /= 255, g /= 255, b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      if (max === min) {
        h = s = 0; // achromatic
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        if (max === r) {
          h = (g - b) / d + (g < b ? 6 : 0);
        } else if (max === g) {
          h = (b - r) / d + 2;
        } else {
          h = (r - g) / d + 4;
        }
        h /= 6;
      }
      return { h, s, l };
    }

    function hslToRgb(h, s, l) {
      let r, g, b;
      if (s === 0) {
        r = g = b = l; // achromatic
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        }
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
    }

    // Adjusts a hex color's saturation by a factor (1 = original, 0 = grayscale)
    function adjustSaturation(hex, factor) {
      const { r, g, b } = hexToRgb(hex);
      const { h, s, l } = rgbToHsl(r, g, b);
      const newS = s * factor;
      const { r: nr, g: ng, b: nb } = hslToRgb(h, newS, l);
      return rgbToHex(nr, ng, nb);
    }

    // ----------------------------------------------------------------
    // 5) Scrolling background drawing with gradient effect
    // ----------------------------------------------------------------
    let offsetX = 0;
    let isPaused = false;

    // Draw the pattern with saturation adjusted based on y position
    function drawPattern() {
      ctx.imageSmoothingEnabled = false;
      for (let y = 0; y < patternRows; y++) {
        // Compute gradient factor (1 at top, 0 at bottom)
        let gradFactor = 1 - y / (patternRows - 1);
        for (let x = 0; x < patternCols; x++) {
          const color = currentPattern[y][(x + offsetX) % patternCols];
          // Adjust the cell's color saturation based on its vertical position
          ctx.fillStyle = adjustSaturation(color, gradFactor);
          const drawX = Math.floor(x * cellWidth);
          const drawY = Math.floor(y * cellHeight);
          const w = Math.ceil(cellWidth);
          const h = Math.ceil(cellHeight);
          ctx.fillRect(drawX, drawY, w, h);
        }
      }
    }

    // ----------------------------------------------------------------
    // 6) "PAUSE" text in the center with gradient effect
    // ----------------------------------------------------------------
    function drawPauseText() {
      ctx.imageSmoothingEnabled = false;
      const pauseText = [
        "        ************************************             ***********************************                                   ****************                                  ************************************             *******************************************",
        "     ***************************************             ***************************************                             ********************                             ***************************************             *******************************************",
        "   *****************************************             *******************************************                       ************************                         *****************************************             *******************************************",
        " *******************************************             *******************************************                     ****************************                     *******************************************             *******************************************",
        " *******************************************             *******************************************                   ********************************                   *******************************************             *******************************************",
        " *************                                           ************                   ************                 *************          *************                 ************                                            ************                               ",
        " *************                                           ************                   ************               *************              *************               ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            ************                               ",
        " *************                                           ************                   ************             *************                  *************             ************                                            *******************************************",
        " **********************************                      *******************************************             ********************************************             ************                                            *******************************************",
        " ***************************************                 *******************************************             ********************************************             ************                                            *******************************************",
        " *****************************************               *******************************************             ********************************************             ************                                            *******************************************",
        "   *****************************************             ***************************************                 ********************************************             ************                                            *******************************************",
        "     ***************************************             ***********************************                     ********************************************             ************                                            *******************************************",
        "        ************************************             ************                                            ********************************************             ************                                            *******************************************",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        "                               *************             ************                                            *************                  *************             ************                                            ************                               ",
        " *******************************************             ************                                            *************                  *************             *******************************************             *******************************************",
        " *******************************************             ************                                            *************                  *************             *******************************************             *******************************************",
        " *******************************************             ************                                            *************                  *************             *******************************************             *******************************************",
        " *****************************************               ************                                            *************                  *************              *****************************************             *******************************************",
        " ***************************************                 ************                                            *************                  *************                 ***************************************             *******************************************",
        " **********************************                      ************                                            *************                  *************                    ************************************             *******************************************",
        "         ",
         "       ",
          "       ",
           "       ",
            "        ",
        "                                                                                   ********************************************                 ***********************************                 ",
        "                                                                                   ********************************************               ***************************************               ",
        "                                                                                   ********************************************             *******************************************             ",
        "                                                                                   ********************************************             *******************************************             ",
        "                                                                                   ********************************************             *******************************************             ",
        "                                                                                   ********************************************             *******************************************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            ************                   ************             ",
        "                                                                                                   *************                            *******************************************             ",
        "                                                                                                   *************                            *******************************************             ",
        "                                                                                                   *************                            *******************************************             ",
        "                                                                                                   *************                            *******************************************             ",
        "                                                                                                   *************                              ***************************************               ",
        "                                                                                                   *************                                ***********************************                 ",
        "        ",
      "        ",
         "        ",
          "        ",
           "        ",
        " ***********************************                                   ****************                           ************                   ************                    ************************************             *******************************************",
        " ***************************************                             ********************                         ************                   ************                 ***************************************             *******************************************",
        " *******************************************                       ************************                       ************                   ************               *****************************************             *******************************************",
        " *******************************************                     ****************************                     ************                   ************             *******************************************             *******************************************",
        " *******************************************                   ********************************                   ************                   ************             *******************************************             *******************************************",
        " ************                   ************                 *************          *************                 ************                   ************             ************                                            ************                               ",
        " ************                   ************               *************              *************               ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             ************                   ************             ************                                            ************                               ",
        " ************                   ************             *************                  *************             *******************************************             *******************************************             *******************************************",
        " ************                   *************                  *************             ************                   ************             ***********************************                     *******************************************",
        " *******************************************             ********************************************             ************                   ************             ***************************************                 *******************************************",
        " *******************************************             ********************************************             ************                   ************             *****************************************               *******************************************",
        " ***************************************                 ********************************************             ************                   ************               *****************************************             *******************************************",
        " ***********************************                     ********************************************             ************                   ************                  **************************************             *******************************************",
        " ************                                            ********************************************             ************                   ************                     ***********************************             *******************************************",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             ************                   ************                                            ************             ************                               ",
        " ************                                            *************                  *************             *******************************************             *******************************************             *******************************************",
        " ************                                            *************                  *************             *******************************************             *******************************************             *******************************************",
        " ************                                            *************                  *************             *******************************************             *******************************************             *******************************************",
        " ************                                            *************                  *************             *******************************************             *****************************************               *******************************************",
        " ************                                            *************                  *************               ***************************************               ***************************************                 *******************************************",
        " ************                                            *************                  *************                 ***********************************                 ************************************                    *******************************************",
        "         "
      ];

      const textRows = pauseText.length;
      const textCols = pauseText[0].length;
      // Find center in "cell" coordinates
      const startX = Math.floor(patternCols / 2) - Math.floor(textCols / 2);
      const startY = Math.floor(patternRows / 2) - Math.floor(textRows / 2);

      for (let row = 0; row < textRows; row++) {
        for (let col = 0; col < pauseText[row].length; col++) {
          if (pauseText[row][col] === '*') {
            const color = pauseTextPattern[row % pauseTextPattern.length][col % pauseTextPattern[0].length];
            // Calculate gradient factor based on vertical position in the overall canvas
            let gradFactor = 1 - ((startY + row) / (patternRows - 1));
            ctx.fillStyle = adjustSaturation(color, gradFactor);
            const drawX = Math.floor((startX + col) * cellWidth);
            const drawY = Math.floor((startY + row) * cellHeight);
            const w = Math.ceil(cellWidth);
            const h = Math.ceil(cellHeight);
            ctx.fillRect(drawX, drawY, w, h);
          }
        }
      }
    }

    // ----------------------------------------------------------------
    // 7) Animation loop
    // ----------------------------------------------------------------
    function animate() {
      if (!isPaused) {
        offsetX = (offsetX + 8) % patternCols;
      }
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPattern();
      drawPauseText();
      requestAnimationFrame(animate);
    }

    // ----------------------------------------------------------------
    // 8) Pause/Resume with Spacebar (momentary pause while held)
    // ----------------------------------------------------------------
    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        isPaused = true;
      }
    });
    window.addEventListener('keyup', (e) => {
      if (e.code === 'Space') {
        isPaused = false;
      }
    });

    // ----------------------------------------------------------------
    // 9) Pause/Resume with Touch (for mobile devices)
    // ----------------------------------------------------------------
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      isPaused = true;
    }, { passive: false });
    canvas.addEventListener('touchend', () => {
      isPaused = false;
    });

    // ----------------------------------------------------------------
    // 10) Pause/Resume with Click (toggle pause on click)
    // ----------------------------------------------------------------
    canvas.addEventListener('click', () => {
      isPaused = !isPaused;
    });

    // Start the animation loop
    animate();
  </script>
</body>
</html>
